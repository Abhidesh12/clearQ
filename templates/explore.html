{% extends "base.html" %}

{% block title %}Find Mentors - ClearQ{% endblock %}

{% block content %}
<style>
    .mentor-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: white;
        border-radius: 16px;
        border: 1px solid #e5e7eb;
        overflow: hidden;
    }
    
    .mentor-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        border-color: #667eea;
    }
    
    .mentor-card-image {
        height: 180px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
        overflow: hidden;
    }
    
    .mentor-card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .mentor-card-avatar {
        position: absolute;
        bottom: -32px;
        left: 20px;
        width: 64px;
        height: 64px;
        border-radius: 16px;
        border: 4px solid white;
        background: white;
        overflow: hidden;
    }
    
    .mentor-card-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .mentor-card-content {
        padding: 20px;
        padding-top: 40px;
    }
    
    .mentor-card-badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .category-badge {
        display: inline-flex;
        align-items: center;
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        background: #f3f4f6;
        color: #4b5563;
        margin: 4px;
        transition: all 0.2s ease;
    }
    
    .category-badge:hover,
    .category-badge.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        transform: translateY(-2px);
    }
    
    .filter-card {
        background: white;
        border-radius: 16px;
        border: 1px solid #e5e7eb;
        padding: 24px;
        position: sticky;
        top: 100px;
    }
    
    .price-slider {
        width: 100%;
        height: 4px;
        background: #e5e7eb;
        border-radius: 2px;
        outline: none;
        -webkit-appearance: none;
    }
    
    .price-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #667eea;
        cursor: pointer;
        border: 4px solid white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .rating-stars {
        display: flex;
        align-items: center;
        gap: 2px;
    }
    
    .rating-stars i {
        color: #fbbf24;
    }
    
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
</style>

<div class="min-h-screen bg-gradient-to-b from-gray-50 to-white">
    <!-- Page Header -->
    <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="text-center">
                <h1 class="text-4xl md:text-5xl font-bold mb-4">Find Your Perfect Mentor</h1>
                <p class="text-xl opacity-90 max-w-3xl mx-auto">
                    Connect with industry experts who can guide you towards your career goals. 
                    Browse through verified mentors with proven track records.
                </p>
                
                <!-- Search Bar -->
                <div class="mt-8 max-w-2xl mx-auto">
                    <form action="/explore" method="GET" class="relative">
                        <div class="relative">
                            <input type="text" 
                                   name="search" 
                                   value="{{ search_query if search_query else '' }}"
                                   placeholder="Search mentors by name, skills, or industry..."
                                   class="w-full px-6 py-4 pl-14 rounded-full text-gray-900 focus:outline-none focus:ring-4 focus:ring-white/20 shadow-lg">
                            <div class="absolute left-5 top-1/2 transform -translate-y-1/2">
                                <i class="fas fa-search text-gray-400 text-lg"></i>
                            </div>
                            <button type="submit"
                                    class="absolute right-2 top-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-2 rounded-full font-medium hover:shadow-lg transition-all">
                                Search
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Filters Sidebar -->
            <div class="lg:col-span-1">
                <div class="filter-card">
                    <h2 class="text-lg font-bold text-gray-900 mb-6">Filters</h2>
                    
                    <!-- Categories -->
                    <div class="mb-8">
                        <h3 class="text-sm font-semibold text-gray-900 mb-4">Categories</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="category" value="mock_interview" class="h-4 w-4 text-blue-600 rounded">
                                <span class="ml-3 text-sm text-gray-700">Mock Interviews</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="category" value="resume_review" class="h-4 w-4 text-blue-600 rounded">
                                <span class="ml-3 text-sm text-gray-700">Resume Review</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="category" value="career_guidance" class="h-4 w-4 text-blue-600 rounded">
                                <span class="ml-3 text-sm text-gray-700">Career Guidance</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="category" value="coding_help" class="h-4 w-4 text-blue-600 rounded">
                                <span class="ml-3 text-sm text-gray-700">Coding Help</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="category" value="salary_negotiation" class="h-4 w-4 text-blue-600 rounded">
                                <span class="ml-3 text-sm text-gray-700">Salary Negotiation</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Industry -->
                    <div class="mb-8">
                        <h3 class="text-sm font-semibold text-gray-900 mb-4">Industry</h3>
                        <select name="industry" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">All Industries</option>
                            {% for industry in industries %}
                            <option value="{{ industry }}" {% if request.args.get('industry') == industry %}selected{% endif %}>
                                {{ industry }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Price Range -->
                    <div class="mb-8">
                        <h3 class="text-sm font-semibold text-gray-900 mb-4">Price Range</h3>
                        <div class="space-y-4">
                            <input type="range" 
                                   min="0" 
                                   max="5000" 
                                   step="500" 
                                   value="2500"
                                   class="price-slider">
                            <div class="flex justify-between text-sm text-gray-600">
                                <span>₹0</span>
                                <span id="price-value">₹2500</span>
                                <span>₹5000</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Experience -->
                    <div class="mb-8">
                        <h3 class="text-sm font-semibold text-gray-900 mb-4">Experience</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="experience" value="1-3" class="h-4 w-4 text-blue-600">
                                <span class="ml-3 text-sm text-gray-700">1-3 years</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="experience" value="3-5" class="h-4 w-4 text-blue-600">
                                <span class="ml-3 text-sm text-gray-700">3-5 years</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="experience" value="5+" class="h-4 w-4 text-blue-600">
                                <span class="ml-3 text-sm text-gray-700">5+ years</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Rating -->
                    <div class="mb-8">
                        <h3 class="text-sm font-semibold text-gray-900 mb-4">Minimum Rating</h3>
                        <div class="space-y-2">
                            {% for i in range(5, 0, -1) %}
                            <label class="flex items-center">
                                <input type="radio" name="rating" value="{{ i }}" class="h-4 w-4 text-blue-600">
                                <span class="ml-3 text-sm text-gray-700">
                                    {{ i }} stars & above
                                </span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Apply Filters Button -->
                    <button id="apply-filters" 
                            class="w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-medium rounded-lg hover:shadow-lg transition-all">
                        Apply Filters
                    </button>
                    
                    <!-- Reset Filters -->
                    <button id="reset-filters" 
                            class="w-full mt-3 py-2 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">
                        Reset All
                    </button>
                </div>
                
                <!-- Quick Stats -->
                <div class="mt-6 bg-white rounded-xl border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Platform Stats</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Total Mentors</span>
                            <span class="font-semibold text-gray-900">{{ mentors|length }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Active Sessions</span>
                            <span class="font-semibold text-gray-900">24/7</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Success Rate</span>
                            <span class="font-semibold text-green-600">94%</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Avg. Response Time</span>
                            <span class="font-semibold text-gray-900">< 24h</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mentors Grid -->
            <div class="lg:col-span-3">
                <!-- Results Header -->
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">
                            {% if search_query %}
                            Search Results for "{{ search_query }}"
                            {% else %}
                            All Mentors
                            {% endif %}
                        </h2>
                        <p class="text-gray-600 mt-1">
                            {{ mentors|length }} mentors found
                        </p>
                    </div>
                    
                    <div class="flex items-center space-x-3 mt-4 sm:mt-0">
                        <select class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option>Sort by: Rating</option>
                            <option>Price: Low to High</option>
                            <option>Price: High to Low</option>
                            <option>Experience</option>
                            <option>Most Booked</option>
                        </select>
                        
                        <button class="p-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            <i class="fas fa-th-large text-gray-600"></i>
                        </button>
                        <button class="p-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            <i class="fas fa-list text-gray-600"></i>
                        </button>
                    </div>
                </div>
                
                {% if mentors and mentors|length > 0 %}
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    {% for mentor in mentors %}
                    <div class="mentor-card">
                        <div class="mentor-card-image">
                            {% if mentor.user.profile_image %}
                            <img src="{{ mentor.user.profile_image }}" alt="{{ mentor.user.full_name }}">
                            {% endif %}
                            
                            <div class="mentor-card-avatar">
                                {% if mentor.user.profile_image %}
                                <img src="{{ mentor.user.profile_image }}" alt="{{ mentor.user.full_name }}">
                                {% else %}
                                <div class="w-full h-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white text-xl font-bold">
                                    {{ (mentor.user.full_name[0] if mentor.user.full_name else mentor.user.username[0])|upper }}
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- Verified Badge -->
                            {% if mentor.is_approved %}
                            <div class="absolute top-4 right-4">
                                <div class="bg-white rounded-full p-2 shadow-md">
                                    <div class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center">
                                        <i class="fas fa-check text-white text-xs"></i>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="mentor-card-content">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h3 class="font-bold text-gray-900 text-lg">{{ mentor.user.full_name if mentor.user.full_name else mentor.user.username }}</h3>
                                    <p class="text-gray-600 text-sm">{{ mentor.job_title if mentor.job_title else 'Expert Mentor' }}</p>
                                </div>
                                
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-gray-900">₹{{ mentor.hourly_rate if mentor.hourly_rate else 0 }}</div>
                                    <div class="text-sm text-gray-500">per hour</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center mb-4">
                                <div class="rating-stars mr-2">
                                    {% for i in range(5) %}
                                    <i class="fas fa-star {{ 'text-yellow-400' if i < (mentor.rating|int) else 'text-gray-300' }}"></i>
                                    {% endfor %}
                                </div>
                                <span class="text-sm text-gray-700 font-medium">{{ mentor.rating if mentor.rating else '4.9' }}</span>
                                <span class="text-sm text-gray-500 ml-1">({{ mentor.total_reviews if mentor.total_reviews else '24' }})</span>
                            </div>
                            
                            <p class="text-gray-600 text-sm mb-4 line-clamp-2">
                                {{ mentor.user.bio if mentor.user.bio else 'Experienced professional with a passion for mentoring.' }}
                            </p>
                            
                            <div class="flex flex-wrap gap-2 mb-6">
                                {% if mentor.skills %}
                                {% set skills = mentor.skills.split(',')[:3] %}
                                {% for skill in skills %}
                                <span class="px-3 py-1 bg-gray-100 text-gray-700 text-xs rounded-full">
                                    {{ skill.strip() }}
                                </span>
                                {% endfor %}
                                {% if mentor.skills.split(',')|length > 3 %}
                                <span class="px-3 py-1 bg-gray-100 text-gray-700 text-xs rounded-full">
                                    +{{ mentor.skills.split(',')|length - 3 }} more
                                </span>
                                {% endif %}
                                {% endif %}
                            </div>
                            
                            <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                                <div class="text-sm text-gray-600">
                                    <i class="fas fa-briefcase mr-1"></i>
                                    {{ mentor.experience if mentor.experience else '5+' }} years
                                </div>
                                
                                <a href="/mentor/{{ mentor.user.username }}" 
                                   class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white text-sm font-medium rounded-lg hover:shadow-lg transition-all">
                                    View Profile
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination -->
                <div class="mt-12 flex justify-center">
                    <nav class="flex items-center space-x-2">
                        <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        
                        <button class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-medium">
                            1
                        </button>
                        
                        <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            2
                        </button>
                        
                        <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            3
                        </button>
                        
                        <span class="px-2 text-gray-500">...</span>
                        
                        <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            10
                        </button>
                        
                        <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </nav>
                </div>
                {% else %}
                <div class="text-center py-16">
                    <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-gray-100 flex items-center justify-center">
                        <i class="fas fa-search text-gray-400 text-3xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">No mentors found</h3>
                    <p class="text-gray-600 max-w-md mx-auto mb-8">
                        {% if search_query %}
                        No mentors match your search criteria. Try different keywords or browse all mentors.
                        {% else %}
                        There are no mentors available at the moment. Please check back later.
                        {% endif %}
                    </p>
                    {% if search_query %}
                    <a href="/explore" 
                       class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-medium rounded-lg hover:shadow-lg transition-all">
                        Browse All Mentors
                    </a>
                    {% endif %}
                </div>
                {% endif %}
                
                <!-- Call to Action -->
                <div class="mt-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-8 text-center text-white">
                    <h3 class="text-2xl font-bold mb-4">Want to become a mentor?</h3>
                    <p class="text-lg opacity-90 mb-6 max-w-2xl mx-auto">
                        Share your knowledge, help others grow, and earn money doing what you love.
                    </p>
                    <a href="/register?role=mentor" 
                       class="inline-flex items-center px-8 py-3 bg-white text-blue-600 font-bold rounded-lg hover:bg-gray-100 transition-colors">
                        Apply as Mentor
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Price slider
        const priceSlider = document.querySelector('.price-slider');
        const priceValue = document.getElementById('price-value');
        
        if (priceSlider && priceValue) {
            priceSlider.addEventListener('input', function() {
                priceValue.textContent = '₹' + this.value;
            });
        }
        
        // Apply filters
        const applyFiltersBtn = document.getElementById('apply-filters');
        const resetFiltersBtn = document.getElementById('reset-filters');
        
        if (applyFiltersBtn) {
            applyFiltersBtn.addEventListener('click', function() {
                const selectedCategories = Array.from(document.querySelectorAll('input[name="category"]:checked'))
                    .map(cb => cb.value);
                const industry = document.querySelector('select[name="industry"]').value;
                const experience = document.querySelector('input[name="experience"]:checked')?.value;
                const rating = document.querySelector('input[name="rating"]:checked')?.value;
                
                // Build query parameters
                const params = new URLSearchParams();
                
                if (selectedCategories.length > 0) {
                    params.append('categories', selectedCategories.join(','));
                }
                if (industry) {
                    params.append('industry', industry);
                }
                if (experience) {
                    params.append('experience', experience);
                }
                if (rating) {
                    params.append('rating', rating);
                }
                
                // Get current search query
                const currentSearch = new URLSearchParams(window.location.search).get('search');
                if (currentSearch) {
                    params.append('search', currentSearch);
                }
                
                // Update URL
                window.location.search = params.toString();
            });
        }
        
        if (resetFiltersBtn) {
            resetFiltersBtn.addEventListener('click', function() {
                // Clear all filters
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.querySelectorAll('input[type="radio"]').forEach(rb => rb.checked = false);
                document.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
                
                // Reset price slider
                if (priceSlider) {
                    priceSlider.value = 2500;
                    priceValue.textContent = '₹2500';
                }
                
                // Redirect to base explore page
                window.location.href = '/explore';
            });
        }
        
        // Initialize tooltips for mentor cards
        tippy('[data-tippy-content]', {
            arrow: true,
            animation: 'scale',
            duration: 200,
        });
    });
</script>
{% endblock %}
